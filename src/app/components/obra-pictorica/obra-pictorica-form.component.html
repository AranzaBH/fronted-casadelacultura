<div class="form-wrapper">
    <div *ngIf="message" 
         class="alert-custom" 
         [ngClass]="{'alert-success': messageType === 'success', 'alert-danger': messageType === 'error'}"
         [@fadeSlide]>
      <div class="alert-icon">
        <i [class]="messageType === 'success' ? 'pi pi-check-circle' : 'pi pi-exclamation-circle'"></i>
      </div>
      <span class="alert-message">{{ message }}</span>
    </div>
  
    <form #formulario="ngForm" (ngSubmit)="save()" class="form-container">
      <div class="form-header">
        <div class="form-title-decoration"></div>
        <h2 class="form-title">
          {{ !obra.id ? 'Crear Obra' : 'Actualizar Obra' }}
        </h2>
        <div class="form-title-decoration"></div>
      </div>
  
      <div class="form-body">
        <!-- Información básica -->
        <div class="form-section">
          <h3 class="section-title">Información Básica</h3>
          
          <div class="form-group">
            <label for="titulo" class="form-label">
              <i class="pi pi-book"></i>
              <span>Título</span>
            </label>
            <div class="input-container">
              <input
                type="text"
                id="titulo"
                name="titulo"
                [(ngModel)]="obra.titulo"
                class="form-control"
                placeholder="Ingrese el título"
                required
                #titulo="ngModel"
              />
              <span class="focus-border"><i></i></span>
            </div>
            <div *ngIf="titulo.invalid && (titulo.dirty || titulo.touched)" class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              El título es requerido
            </div>
          </div>

          <div class="form-group">
            <label for="tituloOriginal" class="form-label">
              <i class="pi pi-book"></i>
              <span>Título Original</span>
            </label>
            <div class="input-container">
              <input
                type="text"
                id="tituloOriginal"
                name="tituloOriginal"
                [(ngModel)]="obra.tituloOriginal"
                class="form-control"
                placeholder="Ingrese el título original"
                required
                #tituloOriginal="ngModel"
              />
              <span class="focus-border"><i></i></span>
            </div>
            <div *ngIf="tituloOriginal.invalid && (tituloOriginal.dirty || tituloOriginal.touched)" class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              El título original es requerido
            </div>
          </div>
  
          <div class="form-group">
            <label for="descripcion" class="form-label">
              <i class="pi pi-align-left"></i>
              <span>Descripción</span>
            </label>
            <div class="input-container">
              <textarea
                id="descripcion"
                name="descripcion"
                [(ngModel)]="obra.descripcion"
                class="form-control"
                rows="4"
                placeholder="Ingrese la descripción del libro"
                required
                #descripcion="ngModel"
              ></textarea>
              <span class="focus-border"><i></i></span>
            </div>
            <div *ngIf="descripcion.invalid && (descripcion.dirty || descripcion.touched)" class="error-message">
              <i class="pi pi-exclamation-circle"></i>
              La descripción es requerida
            </div>
          </div>
        </div>
  
        <!-- Detalles del libro -->
        <div class="form-section">
          <h3 class="section-title">Detalles de la obra</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="codigo" class="form-label">
                <i class="pi pi-id-card"></i>
                <span>Codigo</span>
              </label>
              <div class="input-container">
                <input
                  type="text"
                  id="codigo"
                  name="codigo"
                  [(ngModel)]="obra.codigo"
                  class="form-control"
                  placeholder="Ingrese el codigo"
                  required
                  #codigo="ngModel"
                />
                <span class="focus-border"><i></i></span>
              </div>
            </div>
  
            <div class="form-group">
              <label for="dimension" class="form-label">
                <i class="pi pi-building"></i>
                <span>Dimension</span>
              </label>
              <div class="input-container">
                <input
                  type="text"
                  id="dimension"
                  name="dimension"
                  [(ngModel)]="obra.dimension"
                  class="form-control"
                  placeholder="Ingrese la dimension"
                  required
                  #dimension="ngModel"
                />
                <span class="focus-border"><i></i></span>
              </div>
            </div>
          </div>
          <div class="form-row">
          <div class="form-group">
            <label for="localizacion" class="form-label">
              <i class="pi pi-building"></i>
              <span>Localización</span>
            </label>
            <div class="input-container">
              <input
                type="text"
                id="localizacion"
                name="localizacion"
                [(ngModel)]="obra.localizacion"
                class="form-control"
                placeholder="Ingrese la localizacion"
                required
                #localizacion="ngModel"
              />
              <span class="focus-border"><i></i></span>
            </div>
          </div>

          <div class="form-group">
            <label for="anio" class="form-label">
              <i class="pi pi-calendar"></i>
              <span>Año</span>
            </label>
            <div class="input-container">
              <p-inputNumber
                id="anio"
                name="anio"
                [(ngModel)]="obra.anioObra"
                [showButtons]="false"
                class="form-control"
                placeholder="Año de publicación"
                [min]="1800"
                [max]="2025"
              ></p-inputNumber>
            </div>
          </div>

        </div>
        </div>

  
        <!-- Clasificación y Categoría -->
        <div class="form-section">
          <h3 class="section-title">Tecnica y Categoría</h3>
          
          <div class="form-row">
            
  
            <div class="form-group">
              <label for="categoria" class="form-label">
                <i class="pi pi-tags"></i>
                <span>Categoría</span>
              </label>
              <div class="input-container select-container">
                
                <select
                  id="categoria"
                  name="categoria"
                  [(ngModel)]="obra.categoriaObra"
                  class="form-control custom-select"
                  required
                  #categoria="ngModel"
                >
                  <option value="" disabled selected>Seleccione una categoría</option>
                  <option *ngFor="let categoriaObra of categorias" [ngValue]="categoriaObra">
                    {{ categoriaObra.nombre }}
                  </option>
                </select>
                <span class="select-arrow">
                  <i class="pi pi-chevron-down"></i>
                </span>
              </div>
            </div>


            <div class="form-group">
                <label for="tecnica" class="form-label">
                  <i class="pi pi-tags"></i>
                  <span>Tecnica</span>
                </label>
                <div class="input-container select-container">
                  
                  <select
                    id="tecnica"
                    name="tecnica"
                    [(ngModel)]="obra.tecnica"
                    class="form-control custom-select"
                    required
                    #tecnica="ngModel"
                  >
                    <option value="" disabled selected>Seleccione una tecnica</option>
                    <option *ngFor="let tecnica of tecnicas" [ngValue]="tecnica">
                      {{ tecnica.nombre }}
                    </option>
                  </select>
                  <span class="select-arrow">
                    <i class="pi pi-chevron-down"></i>
                  </span>
                </div>
              </div>
          </div>
  
         
        </div>
<!-- Inicio materiales -->
        <div class="form-section authors-section">
          <h3 class="section-title">
            <i class="pi pi-users"></i>
            Materiales de la obra
          </h3>
          
          <div class="form-group">
            <div class="authors-container">
              <p-multiSelect
                [options]="materiales"
                [(ngModel)]="selectedMateriales"
                [ngModelOptions]="{standalone: true}"
                optionLabel="material"
                placeholder="Buscar y seleccionar materiales"
                [filter]="true"
                filterBy="material,descripcion"
                [showToggleAll]="true"
                styleClass="authors-multiselect"
                [panelStyle]="{minWidth: '100%'}"
              >
                <ng-template pTemplate="header">
                  <div class="multiselect-header">
                    <span class="selected-count">
                      {{ materiales.length }} material(es) seleccionado(s)
                    </span>
                  </div>
                </ng-template>
                
                <ng-template let-material pTemplate="item">
                  <div class="author-item">
                    <div class="author-avatar">
                      <i class="pi pi-user"></i>
                    </div>
                    <div class="author-info">
                      <span class="author-name">
                        {{ material.material }} {{ material.descripcio  }} 
                      </span>
                    </div>
                  </div>
                </ng-template>
        
                <ng-template let-material pTemplate="selectedItem">
                  <div class="selected-author">
                    <i class="pi pi-user"></i>
                    <span>{{ material.material}} {{ material.descripcion }}</span>
                  </div>
                </ng-template>
              </p-multiSelect>
            </div>
        
            <div class="selected-authors-preview" *ngIf="selectedMateriales.length > 0">
              <div class="selected-authors-grid">
                <div class="author-card" *ngFor="let material of selectedMateriales">
                  <div class="author-card-avatar">
                    <i class="pi pi-user"></i>
                  </div>
                  <div class="author-card-info">
                    <h4>{{ material.material }} {{ material.descripcion }}</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  <!-- Fin materiales -->
<div class="form-section authors-section">
  <h3 class="section-title">
    <i class="pi pi-users"></i>
    Autores del obra
  </h3>
  
  <div class="form-group">
    <div class="authors-container">
      <p-multiSelect
        [options]="autores"
        [(ngModel)]="selectedAutores"
        [ngModelOptions]="{standalone: true}"
        optionLabel="nombre"
        placeholder="Buscar y seleccionar autores"
        [filter]="true"
        filterBy="nombre,apellidoPaterno,apellidoMaterno"
        [showToggleAll]="true"
        styleClass="authors-multiselect"
        [panelStyle]="{minWidth: '100%'}"
      >
        <ng-template pTemplate="header">
          <div class="multiselect-header">
            <span class="selected-count">
              {{ selectedAutores.length }} autor(es) seleccionado(s)
            </span>
          </div>
        </ng-template>
        
        <ng-template let-autor pTemplate="item">
          <div class="author-item">
            <div class="author-avatar">
              <i class="pi pi-user"></i>
            </div>
            <div class="author-info">
              <span class="author-name">
                {{ autor.nombre }} {{ autor.apellidoPaterno }} {{ autor.apellidoMaterno }}
              </span>
              <span class="author-type">{{ autor.tipoAutor }}</span>
            </div>
          </div>
        </ng-template>

        <ng-template let-autor pTemplate="selectedItem">
          <div class="selected-author">
            <i class="pi pi-user"></i>
            <span>{{ autor.nombre }} {{ autor.apellidoPaterno }}</span>
          </div>
        </ng-template>
      </p-multiSelect>
    </div>

    <div class="selected-authors-preview" *ngIf="selectedAutores.length > 0">
      <div class="selected-authors-grid">
        <div class="author-card" *ngFor="let autor of selectedAutores">
          <div class="author-card-avatar">
            <i class="pi pi-user"></i>
          </div>
          <div class="author-card-info">
            <h4>{{ autor.nombre }} {{ autor.apellidoPaterno }}</h4>
            <span>{{ autor.tipoAutor }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  
        <div class="form-section image-upload-section">
          <h3 class="image-upload-title">
            <i class="pi pi-image"></i>
            Portada del Libro
          </h3>
          
          <div class="image-upload-container">
            <div class="book-cover-container">
              <div class="book-cover-frame" *ngIf="obra.urlImagenPortada || previewImages.length > 0">
                <img 
                  [src]="previewImages.length > 0 ? previewImages[0] : obra.urlImagenPortada" 
                  alt="Portada del libro" 
                  class="book-cover-image"
                  (click)="openImagePreview(previewImages.length > 0 ? previewImages[0] : obra.urlImagenPortada)"
                />
                <div class="image-preview-actions">
                  <button 
                    type="button" 
                    class="image-action-button remove" 
                    (click)="removeImage()"
                    *ngIf="previewImages.length > 0 || obra.urlImagenPortada"
                    title="Eliminar imagen"
                  >
                    <i class="pi pi-trash"></i>
                  </button>
                  <button 
                    type="button" 
                    class="image-action-button zoom" 
                    (click)="openImagePreview(previewImages.length > 0 ? previewImages[0] : obra.urlImagenPortada)"
                    title="Ver imagen"
                  >
                    <i class="pi pi-search-plus"></i>
                  </button>
                </div>
              </div>
              
              <div class="no-image-placeholder" *ngIf="!obra.urlImagenPortada && previewImages.length === 0">
                <div class="no-image-icon">
                  <i class="pi pi-image"></i>
                </div>
                <div class="no-image-text">
                  No hay portada seleccionada
                </div>
              </div>
              
              <div class="book-cover-info" *ngIf="obra.urlImagenPortada && !previewImages.length">
                Portada actual
              </div>
              <div class="book-cover-info" *ngIf="previewImages.length">
                Nueva portada seleccionada
              </div>
            </div>
            
            <div class="file-upload-wrapper">
              <button type="button" class="file-upload-button">
                <i class="pi pi-upload"></i>
                <span>Seleccionar portada</span>
              </button>
              <input 
                type="file" 
                class="file-upload-input" 
                (change)="onFileSelect($event)" 
                accept="image/*"
              />
            </div>
            
            <div class="file-name-display" *ngIf="selectedFile">
              Archivo seleccionado: {{ selectedFile.name }}
            </div>
          </div>
        </div>
        
        <div class="image-preview-modal" [class.active]="previewModalActive">
          <img [src]="previewModalSrc" alt="Vista previa" class="modal-image" *ngIf="previewModalSrc">
          <div class="modal-close" (click)="closeImagePreview()">
            <i class="pi pi-times"></i>
          </div>
        </div>
  
        
      </div>
  
      <div class="form-footer">
        <button type="submit" 
                class="btn-submit" 
                [disabled]="formulario.invalid"
                [class.disabled]="formulario.invalid">
          <span class="button-content">
            <i class="pi pi-save"></i>
            <span>Guardar Obra</span>
          </span>
          <span class="button-effect"></span>
        </button>
      </div>
    </form>
  </div>